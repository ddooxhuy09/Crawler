import{o as ne}from"./chunk-15a82b54.js";var se={},ae=e=>encodeURIComponent(e).replace(/[!'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toUpperCase()}`),G="%[a-f0-9]{2}",V=new RegExp("("+G+")|([^%]+?)","gi"),J=new RegExp("("+G+")+","gi");function L(e,n){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;n=n||1;var o=e.slice(0,n),p=e.slice(n);return Array.prototype.concat.call([],L(o),L(p))}function ie(e){try{return decodeURIComponent(e)}catch{for(var n=e.match(V)||[],o=1;o<n.length;o++)e=L(n,o).join(""),n=e.match(V)||[];return e}}function oe(e){for(var n={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},o=J.exec(e);o;){try{n[o[0]]=decodeURIComponent(o[0])}catch{var p=ie(o[0]);p!==o[0]&&(n[o[0]]=p)}o=J.exec(e)}n["%C2"]="\uFFFD";for(var y=Object.keys(n),b=0;b<y.length;b++){var l=y[b];e=e.replace(new RegExp(l,"g"),n[l])}return e}var ge=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return oe(e)}},me=(e,n)=>{if(!(typeof e=="string"&&typeof n=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(n==="")return[e];const o=e.indexOf(n);return o===-1?[e]:[e.slice(0,o),e.slice(o+n.length)]},ce=function(e,n){for(var o={},p=Object.keys(e),y=Array.isArray(n),b=0;b<p.length;b++){var l=p[b],c=e[l];(y?n.indexOf(l)!==-1:n(l,c,e))&&(o[l]=c)}return o};(function(e){const n=ae,o=ge,p=me,y=ce,b=r=>r==null,l=Symbol("encodeFragmentIdentifier");function c(r){switch(r.arrayFormat){case"index":return t=>(i,a)=>{const g=i.length;return a===void 0||r.skipNull&&a===null||r.skipEmptyString&&a===""?i:a===null?[...i,[f(t,r),"[",g,"]"].join("")]:[...i,[f(t,r),"[",f(g,r),"]=",f(a,r)].join("")]};case"bracket":return t=>(i,a)=>a===void 0||r.skipNull&&a===null||r.skipEmptyString&&a===""?i:a===null?[...i,[f(t,r),"[]"].join("")]:[...i,[f(t,r),"[]=",f(a,r)].join("")];case"colon-list-separator":return t=>(i,a)=>a===void 0||r.skipNull&&a===null||r.skipEmptyString&&a===""?i:a===null?[...i,[f(t,r),":list="].join("")]:[...i,[f(t,r),":list=",f(a,r)].join("")];case"comma":case"separator":case"bracket-separator":{const t=r.arrayFormat==="bracket-separator"?"[]=":"=";return i=>(a,g)=>g===void 0||r.skipNull&&g===null||r.skipEmptyString&&g===""?a:(g=g===null?"":g,a.length===0?[[f(i,r),t,f(g,r)].join("")]:[[a,f(g,r)].join(r.arrayFormatSeparator)])}default:return t=>(i,a)=>a===void 0||r.skipNull&&a===null||r.skipEmptyString&&a===""?i:a===null?[...i,f(t,r)]:[...i,[f(t,r),"=",f(a,r)].join("")]}}function u(r){let t;switch(r.arrayFormat){case"index":return(i,a,g)=>{if(t=/\[(\d*)\]$/.exec(i),i=i.replace(/\[\d*\]$/,""),!t){g[i]=a;return}g[i]===void 0&&(g[i]={}),g[i][t[1]]=a};case"bracket":return(i,a,g)=>{if(t=/(\[\])$/.exec(i),i=i.replace(/\[\]$/,""),!t){g[i]=a;return}if(g[i]===void 0){g[i]=[a];return}g[i]=[].concat(g[i],a)};case"colon-list-separator":return(i,a,g)=>{if(t=/(:list)$/.exec(i),i=i.replace(/:list$/,""),!t){g[i]=a;return}if(g[i]===void 0){g[i]=[a];return}g[i]=[].concat(g[i],a)};case"comma":case"separator":return(i,a,g)=>{const x=typeof a=="string"&&a.includes(r.arrayFormatSeparator),s=typeof a=="string"&&!x&&w(a,r).includes(r.arrayFormatSeparator);a=s?w(a,r):a;const m=x||s?a.split(r.arrayFormatSeparator).map(d=>w(d,r)):a===null?a:w(a,r);g[i]=m};case"bracket-separator":return(i,a,g)=>{const x=/(\[\])$/.test(i);if(i=i.replace(/\[\]$/,""),!x){g[i]=a&&w(a,r);return}const s=a===null?[]:a.split(r.arrayFormatSeparator).map(m=>w(m,r));if(g[i]===void 0){g[i]=s;return}g[i]=[].concat(g[i],s)};default:return(i,a,g)=>{if(g[i]===void 0){g[i]=a;return}g[i]=[].concat(g[i],a)}}}function C(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(r,t){return t.encode?t.strict?n(r):encodeURIComponent(r):r}function w(r,t){return t.decode?o(r):r}function P(r){return Array.isArray(r)?r.sort():typeof r=="object"?P(Object.keys(r)).sort((t,i)=>Number(t)-Number(i)).map(t=>r[t]):r}function E(r){const t=r.indexOf("#");return t!==-1&&(r=r.slice(0,t)),r}function S(r){let t="";const i=r.indexOf("#");return i!==-1&&(t=r.slice(i)),t}function I(r){r=E(r);const t=r.indexOf("?");return t===-1?"":r.slice(t+1)}function O(r,t){return t.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?r=Number(r):t.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")&&(r=r.toLowerCase()==="true"),r}function M(r,t){t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t),C(t.arrayFormatSeparator);const i=u(t),a=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return a;for(const g of r.split("&")){if(g==="")continue;let[x,s]=p(t.decode?g.replace(/\+/g," "):g,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?s:w(s,t),i(w(x,t),s,a)}for(const g of Object.keys(a)){const x=a[g];if(typeof x=="object"&&x!==null)for(const s of Object.keys(x))x[s]=O(x[s],t);else a[g]=O(x,t)}return t.sort===!1?a:(t.sort===!0?Object.keys(a).sort():Object.keys(a).sort(t.sort)).reduce((g,x)=>{const s=a[x];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?g[x]=P(s):g[x]=s,g},Object.create(null))}e.extract=I,e.parse=M,e.stringify=(r,t)=>{if(!r)return"";t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t),C(t.arrayFormatSeparator);const i=s=>t.skipNull&&b(r[s])||t.skipEmptyString&&r[s]==="",a=c(t),g={};for(const s of Object.keys(r))i(s)||(g[s]=r[s]);const x=Object.keys(g);return t.sort!==!1&&x.sort(t.sort),x.map(s=>{const m=r[s];return m===void 0?"":m===null?f(s,t):Array.isArray(m)?m.length===0&&t.arrayFormat==="bracket-separator"?f(s,t)+"[]":m.reduce(a(s),[]).join("&"):f(s,t)+"="+f(m,t)}).filter(s=>s.length>0).join("&")},e.parseUrl=(r,t)=>{t=Object.assign({decode:!0},t);const[i,a]=p(r,"#");return Object.assign({url:i.split("?")[0]||"",query:M(I(r),t)},t&&t.parseFragmentIdentifier&&a?{fragmentIdentifier:w(a,t)}:{})},e.stringifyUrl=(r,t)=>{t=Object.assign({encode:!0,strict:!0,[l]:!0},t);const i=E(r.url).split("?")[0]||"",a=e.extract(r.url),g=e.parse(a,{sort:!1}),x=Object.assign(g,r.query);let s=e.stringify(x,t);s&&(s=`?${s}`);let m=S(r.url);return r.fragmentIdentifier&&(m=`#${t[l]?f(r.fragmentIdentifier,t):r.fragmentIdentifier}`),`${i}${s}${m}`},e.pick=(r,t,i)=>{i=Object.assign({parseFragmentIdentifier:!0,[l]:!1},i);const{url:a,query:g,fragmentIdentifier:x}=e.parseUrl(r,i);return e.stringifyUrl({url:a,query:y(g,t),fragmentIdentifier:x},i)},e.exclude=(r,t,i)=>{const a=Array.isArray(t)?g=>!t.includes(g):(g,x)=>!t(g,x);return e.pick(r,a,i)}})(se);var W={exports:{}};const le=e=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const n=crypto.getRandomValues(new Uint8Array(1))[0];return(n>=e?n%e:n).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),Z=(e=7,n=!1)=>Array.from({length:e},le(n?16:36)).join("");W.exports=Z;W.exports.default=Z;var D=W.exports,Se=()=>`uid::${D(7)}`,K=(e,n=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&n.every(o=>o in e),Ee=e=>{if(!K(e))throw new TypeError("Invalid connection args");return JSON.stringify(e)},Ce=e=>{try{const n=JSON.parse(e);return K(n)?n:null}catch{return null}},_e=()=>{let e=[];return{add:(...n)=>{e=[...e,...n]},remove:n=>{e=typeof n=="string"?e.filter(o=>o.message.transactionId!==n):e.filter(o=>!n.includes(o))},entries:()=>e}},Fe=class{static toBackground(e,n){return e.postMessage(n)}static toExtensionContext(e,n){return e.postMessage(n)}},Q={exports:{}};(function(e,n){(function(o,p){p(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ne,function(o){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const p="The message port closed before a response was received.",y="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",b=l=>{const c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(m,d=void 0){super(d),this.createItem=m}get(m){return this.has(m)||this.set(m,this.createItem(m)),super.get(m)}}const C=s=>s&&typeof s=="object"&&typeof s.then=="function",f=(s,m)=>(...d)=>{l.runtime.lastError?s.reject(new Error(l.runtime.lastError.message)):m.singleCallbackArg||d.length<=1&&m.singleCallbackArg!==!1?s.resolve(d[0]):s.resolve(d)},w=s=>s==1?"argument":"arguments",P=(s,m)=>function(h,...F){if(F.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${w(m.minArgs)} for ${s}(), got ${F.length}`);if(F.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${w(m.maxArgs)} for ${s}(), got ${F.length}`);return new Promise((T,j)=>{if(m.fallbackToNoCallback)try{h[s](...F,f({resolve:T,reject:j},m))}catch(A){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,A),h[s](...F),m.fallbackToNoCallback=!1,m.noCallback=!0,T()}else m.noCallback?(h[s](...F),T()):h[s](...F,f({resolve:T,reject:j},m))})},E=(s,m,d)=>new Proxy(m,{apply(h,F,T){return d.call(F,s,...T)}});let S=Function.call.bind(Object.prototype.hasOwnProperty);const I=(s,m={},d={})=>{let h=Object.create(null),F={has(j,A){return A in s||A in h},get(j,A,N){if(A in h)return h[A];if(!(A in s))return;let _=s[A];if(typeof _=="function")if(typeof m[A]=="function")_=E(s,s[A],m[A]);else if(S(d,A)){let v=P(A,d[A]);_=E(s,s[A],v)}else _=_.bind(s);else if(typeof _=="object"&&_!==null&&(S(m,A)||S(d,A)))_=I(_,m[A],d[A]);else if(S(d,"*"))_=I(_,m[A],d["*"]);else return Object.defineProperty(h,A,{configurable:!0,enumerable:!0,get(){return s[A]},set(v){s[A]=v}}),_;return h[A]=_,_},set(j,A,N,_){return A in h?h[A]=N:s[A]=N,!0},defineProperty(j,A,N){return Reflect.defineProperty(h,A,N)},deleteProperty(j,A){return Reflect.deleteProperty(h,A)}},T=Object.create(s);return new Proxy(T,F)},O=s=>({addListener(m,d,...h){m.addListener(s.get(d),...h)},hasListener(m,d){return m.hasListener(s.get(d))},removeListener(m,d){m.removeListener(s.get(d))}}),M=new u(s=>typeof s!="function"?s:function(d){const h=I(d,{},{getContent:{minArgs:0,maxArgs:0}});s(h)});let r=!1;const t=new u(s=>typeof s!="function"?s:function(d,h,F){let T=!1,j,A=new Promise(R=>{j=function(k){r||(console.warn(y,new Error().stack),r=!0),T=!0,R(k)}}),N;try{N=s(d,h,j)}catch(R){N=Promise.reject(R)}const _=N!==!0&&C(N);if(N!==!0&&!_&&!T)return!1;const v=R=>{R.then(k=>{F(k)},k=>{let B;k&&(k instanceof Error||typeof k.message=="string")?B=k.message:B="An unexpected error occurred",F({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(k=>{console.error("Failed to send onMessage rejected reply",k)})};return v(_?N:A),!0}),i=({reject:s,resolve:m},d)=>{l.runtime.lastError?l.runtime.lastError.message===p?m():s(new Error(l.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?s(new Error(d.message)):m(d)},a=(s,m,d,...h)=>{if(h.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${w(m.minArgs)} for ${s}(), got ${h.length}`);if(h.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${w(m.maxArgs)} for ${s}(), got ${h.length}`);return new Promise((F,T)=>{const j=i.bind(null,{resolve:F,reject:T});h.push(j),d.sendMessage(...h)})},g={devtools:{network:{onRequestFinished:O(M)}},runtime:{onMessage:O(t),onMessageExternal:O(t),sendMessage:a.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:a.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},x={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":x},services:{"*":x},websites:{"*":x}},I(l,g,c)};o.exports=b(chrome)}else o.exports=globalThis.browser})})(Q);var Oe=Q.exports,fe=Object.defineProperty,Ae=Object.defineProperties,de=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,H=(e,n,o)=>n in e?fe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,Y=(e,n)=>{for(var o in n||(n={}))ue.call(n,o)&&H(e,o,n[o]);if(z)for(var o of z(n))xe.call(n,o)&&H(e,o,n[o]);return e},X=(e,n)=>Ae(e,de(n)),pe=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,ee=e=>{const[,n,o,p]=e.match(pe)||[];return{context:n,tabId:+o,frameId:p?+p:void 0}},Ie=({context:e,tabId:n,frameId:o})=>["background","popup","options"].includes(e)?e:`${e}@${n}${o?`.${o}`:""}`;const he=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],q=Symbol(".toJSON was called"),be=e=>{e[q]=!0;const n=e.toJSON();return delete e[q],n},re=({from:e,seen:n,to_:o,forceEnumerable:p,maxDepth:y,depth:b})=>{const l=o||(Array.isArray(e)?[]:{});if(n.push(e),b>=y)return l;if(typeof e.toJSON=="function"&&e[q]!==!0)return be(e);for(const[c,u]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(u)){l[c]="[object Buffer]";continue}if(u!==null&&typeof u=="object"&&typeof u.pipe=="function"){l[c]="[object Stream]";continue}if(typeof u!="function"){if(!u||typeof u!="object"){l[c]=u;continue}if(!n.includes(e[c])){b++,l[c]=re({from:e[c],seen:[...n],forceEnumerable:p,maxDepth:y,depth:b});continue}l[c]="[Circular]"}}for(const{property:c,enumerable:u}of he)typeof e[c]=="string"&&Object.defineProperty(l,c,{value:e[c],enumerable:p?!0:u,configurable:!0,writable:!0});return l};function ye(e,n={}){const{maxDepth:o=Number.POSITIVE_INFINITY}=n;return typeof e=="object"&&e!==null?re({from:e,seen:[],forceEnumerable:!0,maxDepth:o,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}let te=()=>({events:{},emit(e,...n){(this.events[e]||[]).forEach(o=>o(...n))},on(e,n){return(this.events[e]=this.events[e]||[]).push(n),()=>this.events[e]=(this.events[e]||[]).filter(o=>o!==n)}});var Te=(e,n,o)=>{const p=D(),y=new Map,b=new Map,l=c=>{if(c.destination.context===e&&!c.destination.frameId&&!c.destination.tabId){o?.(c);const{transactionId:u,messageID:C,messageType:f}=c,w=()=>{const E=y.get(u);if(E){const{err:S,data:I}=c;if(S){const O=S,M=self[O.name],r=new(typeof M=="function"?M:Error)(O.message);for(const t in O)r[t]=O[t];E.reject(r)}else E.resolve(I);y.delete(u)}},P=async()=>{let E,S,I=!1;try{const O=b.get(C);if(typeof O=="function")E=await O({sender:c.origin,id:C,data:c.data,timestamp:c.timestamp});else throw I=!0,new Error(`[webext-bridge] No handler registered in '${e}' to accept messages with id '${C}'`)}catch(O){S=O}finally{if(S&&(c.err=ye(S)),l(X(Y({},c),{messageType:"reply",data:E,origin:{context:e,tabId:null},destination:c.origin,hops:[]})),S&&!I)throw E}};switch(f){case"reply":return w();case"message":return P()}}return c.hops.push(`${e}::${p}`),n(c)};return{handleMessage:l,endTransaction:c=>{const u=y.get(c);u?.reject("Transaction was ended before it could complete"),y.delete(c)},sendMessage:(c,u,C="background")=>{const f=typeof C=="string"?ee(C):C,w="Bridge#sendMessage ->";if(!f.context)throw new TypeError(`${w} Destination must be any one of known destinations`);return new Promise((P,E)=>{const S={messageID:c,data:u,destination:f,messageType:"message",transactionId:D(),origin:{context:e,tabId:null},hops:[],timestamp:Date.now()};y.set(S.transactionId,{resolve:P,reject:E});try{l(S)}catch(I){y.delete(S.transactionId),E(I)}})},onMessage:(c,u)=>(b.set(c,u),()=>b.delete(c))}},$=class{constructor(e,n){this.endpointRuntime=e,this.streamInfo=n,this.emitter=te(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},$.initDone||(e.onMessage("__crx_bridge_stream_transfer__",o=>{const{streamId:p,streamTransfer:y,action:b}=o.data,l=$.openStreams.get(p);l&&!l.isClosed&&(b==="transfer"&&l.emitter.emit("message",y),b==="close"&&($.openStreams.delete(p),l.handleStreamClose()))}),$.initDone=!0),$.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:e,action:"transfer"},this.streamInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,n){const o=this.emitter.on(e,n);return Object.assign(o,{dispose:o,close:o})}},U=$;U.initDone=!1;U.openStreams=new Map;var je=e=>{const n=new Map,o=new Map,p=te();e.onMessage("__crx_bridge_stream_open__",l=>new Promise(c=>{const{sender:u,data:C}=l,{channel:f}=C;let w=!1,P=()=>{};const E=()=>{const S=o.get(f);typeof S=="function"?(S(new U(e,X(Y({},C),{endpoint:u}))),w&&P(),c(!0)):w||(w=!0,P=p.on("did-change-stream-callbacks",E))};E()}));async function y(l,c){if(n.has(l))throw new Error("webext-bridge: A Stream is already open at this channel");const u=typeof c=="string"?ee(c):c,C={streamId:D(),channel:l,endpoint:u},f=new U(e,C);return f.onClose(()=>n.delete(l)),await e.sendMessage("__crx_bridge_stream_open__",C,u),n.set(l,f),f}function b(l,c){if(o.has(l))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");o.set(l,c),p.emit("did-change-stream-callbacks")}return{openStream:y,onOpenStreamChannel:b}};export{Fe as P,Y as _,_e as a,Oe as b,Se as c,Te as d,Ee as e,je as f,Ce as g,Ie as h,X as i,ee as p,se as q};
